

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>osh-encrypt-rsync.conf reference &mdash; The Bastion 3.04.00 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/thebastion.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="osh-backup-acl-keys.conf reference" href="osh-backup-acl-keys_conf.html" />
    <link rel="prev" title="osh-http-proxy.conf reference" href="osh-http-proxy_conf.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Bastion
          

          
          </a>

          
            
            
              <div class="version">
                3.04.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../presentation/index.html">Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation &amp; Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using/index.html">Using the bastion</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Administration</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Configuration files</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="bastion_conf.html">bastion.conf reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="osh-http-proxy_conf.html">osh-http-proxy.conf reference</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">osh-encrypt-rsync.conf reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#option-list">Option List</a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-reference">Option Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="osh-backup-acl-keys_conf.html">osh-backup-acl-keys.conf reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="osh-piv-grace-reaper_conf.html">osh-piv-grace-reaper.conf reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="osh-sync-watcher_sh.html">osh-sync-watcher.sh reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../logs.html">Logs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Bastion plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Bastion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Administration</a> &raquo;</li>
        
          <li><a href="index.html">Configuration files</a> &raquo;</li>
        
      <li>osh-encrypt-rsync.conf reference</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/administration/configuration/osh-encrypt-rsync_conf.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="osh-encrypt-rsync-conf-reference">
<h1>osh-encrypt-rsync.conf reference<a class="headerlink" href="#osh-encrypt-rsync-conf-reference" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The osh-encrypt-rsync script is called by cron and is responsible for encrypting
and optionally pushing the recorded <code class="docutils literal notranslate"><span class="pre">ttyrec</span></code> files to a distant server.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If left unconfigured, this script won't do anything, and recorded <code class="docutils literal notranslate"><span class="pre">ttyrec</span></code> files
won't be encrypted or moved out from the server. This might not be a problem for
low-traffic bastions or if you have plenty of storage available, though.</p>
</div>
<div class="section" id="option-list">
<h2>Option List<a class="headerlink" href="#option-list" title="Permalink to this headline">¶</a></h2>
<div class="section" id="logging-options">
<h3>Logging options<a class="headerlink" href="#logging-options" title="Permalink to this headline">¶</a></h3>
<p>These options configure the way the script logs its actions</p>
<ul class="simple">
<li><a class="reference internal" href="#logfile">logfile</a></li>
<li><a class="reference internal" href="#syslog-facility">syslog_facility</a></li>
</ul>
</div>
<div class="section" id="encryption-and-signing-options">
<h3>Encryption and signing options<a class="headerlink" href="#encryption-and-signing-options" title="Permalink to this headline">¶</a></h3>
<p>These options configure how the script uses GPG to encrypt and sign the ttyrec files</p>
<ul class="simple">
<li><a class="reference internal" href="#signing-key">signing_key</a></li>
<li><a class="reference internal" href="#signing-key-passphrase">signing_key_passphrase</a></li>
<li><a class="reference internal" href="#recipients">recipients</a></li>
<li><a class="reference internal" href="#encrypt-and-move-to-directory">encrypt_and_move_to_directory</a></li>
<li><a class="reference internal" href="#encrypt-and-move-delay-days">encrypt_and_move_delay_days</a></li>
</ul>
</div>
<div class="section" id="push-files-to-a-remote-destination-options">
<h3>Push files to a remote destination options<a class="headerlink" href="#push-files-to-a-remote-destination-options" title="Permalink to this headline">¶</a></h3>
<p>These options configure the way the script uses rsync to optionally push the encrypted files out of the server</p>
<ul class="simple">
<li><a class="reference internal" href="#rsync-destination">rsync_destination</a></li>
<li><a class="reference internal" href="#rsync-rsh">rsync_rsh</a></li>
<li><a class="reference internal" href="#rsync-delay-before-remove-days">rsync_delay_before_remove_days</a></li>
</ul>
</div>
</div>
<div class="section" id="option-reference">
<h2>Option Reference<a class="headerlink" href="#option-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<div class="section" id="logfile">
<h4>logfile<a class="headerlink" href="#logfile" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">string,</span> <span class="pre">path</span> <span class="pre">to</span> <span class="pre">a</span> <span class="pre">file</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></td>
</tr>
</tbody>
</table>
<p>File where the logs will be written to (don't forget to configure <code class="docutils literal notranslate"><span class="pre">logrotate</span></code>!). Note that using this configuration option, the script will directly write to the file, without using syslog. If empty, won't log directly to any file.</p>
</div>
<div class="section" id="syslog-facility">
<h4>syslog_facility<a class="headerlink" href="#syslog-facility" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">local6</span></code></td>
</tr>
</tbody>
</table>
<p>The syslog facility to use for logging the script output. If set to the empty string, we'll not log through syslog at all. If this configuration option is missing from your config file altogether, the default value will be used (local6), which means that we'll log to syslog.</p>
</div>
</div>
<div class="section" id="encryption-and-signing">
<h3>Encryption and signing<a class="headerlink" href="#encryption-and-signing" title="Permalink to this headline">¶</a></h3>
<div class="section" id="signing-key">
<h4>signing_key<a class="headerlink" href="#signing-key" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">string,</span> <span class="pre">GPG</span> <span class="pre">key</span> <span class="pre">ID</span> <span class="pre">in</span> <span class="pre">short</span> <span class="pre">or</span> <span class="pre">long</span> <span class="pre">format</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">(none),</span> <span class="pre">setting</span> <span class="pre">a</span> <span class="pre">value</span> <span class="pre">is</span> <span class="pre">mandatory</span></code></td>
</tr>
</tbody>
</table>
<p>ID of the GPG key used to sign the ttyrec files. The key must be in the local root keyring, check it with <code class="docutils literal notranslate"><span class="pre">gpg</span> <span class="pre">--list-secret-keys</span></code></p>
</div>
<div class="section" id="signing-key-passphrase">
<h4>signing_key_passphrase<a class="headerlink" href="#signing-key-passphrase" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">(none),</span> <span class="pre">setting</span> <span class="pre">a</span> <span class="pre">value</span> <span class="pre">is</span> <span class="pre">mandatory</span></code></td>
</tr>
</tbody>
</table>
<p>This passphrase should be able to unlock the <code class="docutils literal notranslate"><span class="pre">signing_key</span></code> defined above. As a side note, please ensure this configuration file only readable by root (0640), to protect this passphrase. As a security measure, the script will refuse to read the configuration otherwise.</p>
</div>
<div class="section" id="recipients">
<h4>recipients<a class="headerlink" href="#recipients" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">array</span> <span class="pre">of</span> <span class="pre">array</span> <span class="pre">of</span> <span class="pre">strings,</span> <span class="pre">a</span> <span class="pre">string</span> <span class="pre">being</span> <span class="pre">a</span> <span class="pre">GPG</span> <span class="pre">key</span> <span class="pre">ID</span> <span class="pre">in</span> <span class="pre">short</span> <span class="pre">or</span> <span class="pre">long</span> <span class="pre">format</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">(none),</span> <span class="pre">setting</span> <span class="pre">a</span> <span class="pre">value</span> <span class="pre">is</span> <span class="pre">mandatory</span></code></td>
</tr>
</tbody>
</table>
<p>The ttyrecs will be encrypted with those GPG keys, possibly using multi-layer GPG encryption.
Each sub-array is a layer, the first sub-array being the first encryption layer (which is also the last one for decryption)
To completely decrypt a ttyrec, one would need at least one key of each layer.
To encrypt only to a single layer and to only one key, simply use [ [ &quot;KEYID&quot; ] ].
To encrypt to a single layer but with 3 keys being able to decrypt the ttyrec, use [ [ &quot;KEY1&quot;, &quot;KEY2&quot;, &quot;KEY3&quot; ] ], etc.
A common use of multi-layer encryption is to have the first layer composed of the auditors' GPG keys, and
the second layer composed of the sysadmins' GPG keys. During an audit, the sysadmins would get the ttyrec encrypted file,
decrypt the second encryption layer (the first for decryption), and handle the now only auditor-protected file to the auditors.
All public keys must be in the local keyring (gpg --list-keys).
Don't forget to trust those keys &quot;ultimately&quot; in your keyring, too (gpg --edit-key ID)</p>
</div>
<div class="section" id="encrypt-and-move-to-directory">
<h4>encrypt_and_move_to_directory<a class="headerlink" href="#encrypt-and-move-to-directory" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">string,</span> <span class="pre">a</span> <span class="pre">valid</span> <span class="pre">directory</span> <span class="pre">name</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">/home/.encrypt</span></code></td>
</tr>
</tbody>
</table>
<p>After encryption (and compression), move ttyrec files to subdirs of this directory. It'll be created if it doesn't exist yet. You may want this directory to be the mount point of a remote filer, if you wish. If you change this, it's probably a good idea to ensure that the path is excluded from the master/slave synchronization, in <code class="docutils literal notranslate"><span class="pre">/etc/bastion/osh-sync-watcher.rsyncfilter</span></code>. This is already the case for the default value.</p>
</div>
<div class="section" id="encrypt-and-move-delay-days">
<h4>encrypt_and_move_delay_days<a class="headerlink" href="#encrypt-and-move-delay-days" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">&gt;</span> <span class="pre">0</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">14</span></code></td>
</tr>
</tbody>
</table>
<p>Don't touch ttyrec files that have a modification time more recent than this amount of days. They won't be encrypted nor moved yet, and will still be readable by the <code class="docutils literal notranslate"><span class="pre">selfPlaySession</span></code> command.</p>
</div>
</div>
<div class="section" id="push-files-to-a-remote-destination">
<h3>Push files to a remote destination<a class="headerlink" href="#push-files-to-a-remote-destination" title="Permalink to this headline">¶</a></h3>
<div class="section" id="rsync-destination">
<h4>rsync_destination<a class="headerlink" href="#rsync-destination" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">user&#64;remotebackup.example.org:/remote/dir</span></code></td>
</tr>
</tbody>
</table>
<p>The value of this option will be passed to <code class="docutils literal notranslate"><span class="pre">rsync</span></code> as the destination. If empty, this will <strong>disable</strong> <code class="docutils literal notranslate"><span class="pre">rsync</span></code>, meaning that the ttyrec files will be encrypted, but not moved out of the server.</p>
</div>
<div class="section" id="rsync-rsh">
<h4>rsync_rsh<a class="headerlink" href="#rsync-rsh" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Example:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-p</span> <span class="pre">222</span> <span class="pre">-i</span> <span class="pre">/root/.ssh/id_ed25519_backup</span></code></td>
</tr>
</tbody>
</table>
<p>The value of this option will be passed to <code class="docutils literal notranslate"><span class="pre">rsync</span></code>'s <code class="docutils literal notranslate"><span class="pre">--rsh</span></code> option. This is useful to specify an SSH key or an alternate SSH port for example. This option is ignored when <code class="docutils literal notranslate"><span class="pre">rsync</span></code> is disabled (i.e. when <code class="docutils literal notranslate"><span class="pre">rsync_destination</span></code> is empty).</p>
</div>
<div class="section" id="rsync-delay-before-remove-days">
<h4>rsync_delay_before_remove_days<a class="headerlink" href="#rsync-delay-before-remove-days" title="Permalink to this headline">¶</a></h4>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Default:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">0</span></code></td>
</tr>
</tbody>
</table>
<p>After encryption/compression, and successful rsync to remote, wait for this amount of days before removing the encrypted/compressed files locally. Specify 0 to remove the files as soon as they're transferred. This option is ignored when <code class="docutils literal notranslate"><span class="pre">rsync</span></code> is disabled (i.e. when <code class="docutils literal notranslate"><span class="pre">rsync_destination</span></code> is empty).</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="osh-backup-acl-keys_conf.html" class="btn btn-neutral float-right" title="osh-backup-acl-keys.conf reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="osh-http-proxy_conf.html" class="btn btn-neutral float-left" title="osh-http-proxy.conf reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, OVHcloud

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>